Практическое использование алгоритма Шамира для инициализации сервисов в духе Hashiсorp Vault, с возможностью поддержки PKCS#11 для дополнительной безопасности.
---
Один из способов это сделать.

1. Определяем следующие сущности:
  a. Шамировский ключ
  b. Промежуточный ключ (AES-256) + IV
  c. Сертификат Init Admin-а.
2. Генерируем Шамировские ключи вместе с хранилищем, никому не показываем.
3. Там же, для каждого Шамировского ключа, генерим промежуточный AES-256 ключ и IV.
  a. Затем криптуем Шамировские ключи соответствующими промежуточными ключами и IV.
  b. Сохраняем Шамировские ключи в криптованном виде вместе с нашим хранилищем.
4. Каждому промежуточному AES-256 ключу должен соответствовать Init Admin, со своим публичным.
  a. Каждый промежуточный AES-256 ключ криптуем публичным ключом соответствующего Init Admin-а.
  b. Сохраняем промежуточные ключи в криптованном виде и их IV вместе с нашим хранилищем.
  c. Также сохраняем Public Keys для референса.

Теперь, для unseal следует произвести следующие действия:

1. Кворум Init-Admin-ов получают закриптованные промежуточные ключи.
2. Init-Admin-ы используют свои приватные ключи для раскриптования промежуточных ключей, возвращая их в Vault.
3. Vault получает раскриптованые промежуточные ключи от Init-Admin-ов, использует их и соответствующие IV для раскриптования Шамировских ключей.
4. Далее по алгоритму Шамира вычисляется главный ключ.
5. Производится Unseal.
6. Если видится необходимым, теперь можно сменить все промежуточные ключи (т.к. они вышли вовне и могли быть скомпрометированы) и перекриптовать Шамировские ключи.
